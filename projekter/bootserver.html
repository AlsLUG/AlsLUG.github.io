<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="chrome=1">
		<title>AlsLUG.dk - Alssund Linux Brugergruppe</title>

		<link rel="stylesheet" href="/stylesheets/styles.css">
		<link rel="stylesheet" href="/stylesheets/github-light.css">
		<meta name="viewport" content="width=device-width">
		<!--[if lt IE 9]>
			<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->
		<script src="/javascripts/w3data.js"></script>
	</head>
	<body>
		<div class="wrapper">
			<header w3-include-html="header.include"></header>
			<noscript><a href="header.include">Menu</a></noscript>
			<section>
<h1>Opsætning af netboot-server</h1>
<h2>Basis maksine</h2>
Vores nye server er en "tilfælig" doneret pc som har god plads til en masse harddisks.
Den er blevet installeret med en standard 18.04 ubuntu-server. Eller rettere via et ubuntu-mini image serveret fra vores gamle boot-server.

<h2>Opsætning af dit network-layout</h2>
<div>
	Vi har vores net LAN kørende på 192.168.201.1/24,
	hvor vores gamle router kører på 192.168.201.1
	og vores gamle netboot-server kører på 192.168.201.4.
	På grund af tidligere problemer med dns-opslag via husets router,
	benytter vi 4.2.2.2, som er en af level3.net's offentlige dns-servere,
	som default dns-resolver.<p>Det kunne for så vidt lige så godt være 8.8.8.8 fra google eller 1.1.1.1 fra cloudflare.com.</p>
</div>


<h2>DHCP-server</h2>
<pre class='code'>sudo apt-get install isc-dhcp-server</pre>
<pre class='code'>sudo nano /etc/dhcp/dhcpd.conf </pre>
<pre class='code'>
ddns-update-style none;
option domain-name "lokale.alslug.dk";
option domain-name-servers 127.0.1.1;
default-lease-time 600;
max-lease-time 7200;
log-facility local7;
subnet 192.168.201.0 netmask 255.255.255.0 {
        range 192.168.201.2 192.168.201.254;
        option routers 192.168.201.1;
        option subnet-mask 255.255.255.0;
        option broadcast-address 192.168.201.255;
        option domain-name-servers 4.2.2.2;

        filename "pxelinux.0";
        next-server 192.168.201.4;
}
</pre>
<pre class='code'>sudo invoke-rc.d isc-dhcp-server status</pre>
<h2>IPTABLES</h2>

<h3>Opsætning af routing:</h3>
<pre class='code'>sudo nano /etc/sysctl.conf</pre>
Omkring linie 28 finde du denne linie:
<pre class='code'>#net.ipv4.ip_forward=1 </pre>
Den ændres til:
<pre class='code'>net.ipv4.ip_forward=1 </pre>

<div class='one-liner'>
	<pre class='code'>sudo sed "s/#net\.ipv4\.ip_forward=1/net\.ipv4\.ip_forward=1/" -i /etc/sysctl.conf</pre>
</div>

<h3>Opsætning af NAT:</h3>
<pre class='code'>sudo nano /etc/rc.local</pre>
Tilføjes følgende i slutningen af filen:
<pre class='code'>
/sbin/iptables -P FORWARD ACCEPT
/sbin/iptables --table nat -A POSTROUTING -o eth0 -j MASQUERADE
</pre>

<pre class='code'>sudo systemctl start rc-local.service</pre>

<h2>Tillykke! Du burde nu have fået liv i en NAT-router</h2>
			</section>
			<footer>
				<p><small>
					Hosted on GitHub Pages
					<br>
					Theme based on <a href="https://github.com/orderedlist">orderedlist</a>
				</small></p>
			</footer>
		</div>
		<script src="/javascripts/scale.fix.js"></script>
		<script>w3IncludeHTML();</script>
	</body>
</html>

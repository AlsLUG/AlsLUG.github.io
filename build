#!/bin/bash

if [ "$1" = "" ] ; then
	cd ../alslug.dk-content &&
	find -type f -not name template.html -not -path -name '*.html' -exec ../$0 \{\} \;
elif [ -f "$1" ] ; then
	mkdir $( dirname ../$1 ) -pv
	(
		cat ../alslug.dk-content/template.html | sed ':a;N;$!ba;s/<section>.*/<section>/'
		cat $1					|
		sed "s/####\(.*\)####/<h4>\1<\/h4>/g"	|
		sed "s/###\(.*\)###/<h3>\1<\/h3>/g"	|
		sed "s/##\(.*\)##/<h2>\1<\/h2>/g"	|
		sed "s/#\(.*\)#/<h1>\1<\/h1>/g"
		cat ../alslug.dk-content/template.html | sed ':a;N;$!ba;s/.*<\/section>/<\/section>/'
	) > ../$1
fi

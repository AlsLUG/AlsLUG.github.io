#!/bin/bash

if [ "$1" = "" ] ; then
	cd pages &&
	find -type f -not -path '\./pages/.*' -exec ../$0 \{\} \;
elif [ -f "$1" ] ; then
	(
		cat ../template.html | sed ':a;N;$!ba;s/<section>.*/<section>/'
		cat $1 | sed "s/#(.*)#/<h1>\\1<\/h1>/g"
		cat ../template.html | sed ':a;N;$!ba;s/.*<\/section>/<\/section>/'
	) > ../$( echo $1 | md5sum | awk '{ print $1 }' ).html
fi
